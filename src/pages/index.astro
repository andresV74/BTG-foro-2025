---
import Layout from "@/layouts/layout.astro";
import Header from "@/sections/Header.astro";
import Form from "@/components/Form.astro";
import Quote from "@/sections/Quote.astro";
import StripesUp from "@/components/stripesUp.astro";
import StripesDown from "@/components/stripesDown.astro";
import Speakers from "@/sections/Speakers.astro";
import Panel from "@/sections/Panel.astro";
import Banners from "@/sections/FinalBanners.astro";
import Footer from "@/sections/Footer.astro";
import Button from "@/components/Button.astro";

import { speakersData } from "@/consts/speakers";
---

<Layout>
  <Header page="home" />
  <Form />
  <Quote />
  <StripesUp />
  {
    speakersData.map(
      ({ color, title, image, name, position_1, position_2, description }) => (
        <Speakers
          color={color}
          title={title}
          image={image}
          name={name}
          position_1={position_1}
          position_2={position_2}
          description={description}
        />
      )
    )
  }
  <Panel />
  <StripesDown />
  <Banners />
  <Footer />
  <div class="fixed bottom-22 right-2 lg:right-3">
    <Button buttonClass="floating-button hidden" text_1="RegÃ­strese" text_2="ahora" />
  </div>
</Layout>

<script>
  const floatingButton = document.querySelector(
    ".floating-button"
  ) as HTMLButtonElement;
  const form = document.querySelector("#subscribe-form") as HTMLFormElement;

  floatingButton?.addEventListener("click", function (e) {
    e.preventDefault();
    const header = document.querySelector(".header") as HTMLElement;
    const headerHeight = header?.offsetHeight || 0;

    window.scrollTo({
      top: headerHeight,
      behavior: "smooth",
    });
  });

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          floatingButton?.classList.add("hidden");
        } else {
          floatingButton?.classList.remove("hidden");
        }
      });
    },
    { threshold: 0.1 }
  );
  observer.observe(form);
</script>
